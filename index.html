<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Name Picker Wheel</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; }
  #controls { margin: 20px; }
  select, label { font-size: 16px; margin: 5px; }
  #wheelContainer { position: relative; display: inline-block; }
  #wheelCanvas { display: block; background: white; border-radius: 50%; border: 4px solid #333; }

  /* Spin button positioned at bottom center of canvas */
  #spinButton {
    position: absolute;
    bottom: -40px; /* adjust vertical offset */
    left: 50%;
    transform: translateX(-50%);
    font-size: 20px;       /* larger text */
    padding: 15px 40px;    /* taller and wider */
    background-color: #ff4444;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  #spinButton:hover {
    background-color: #ff6666;
  }

  #fontControls {
    margin-top: 10px;
  }
  button { font-size: 16px; margin: 5px; padding: 8px 16px; border-radius: 5px; cursor: pointer; }
</style>
</head>
<body>
<h1>Name Picker Wheel</h1>

<div id="controls">
  <select id="groupSelect"></select>
  <label>
    <input type="checkbox" id="allowRepeats"> Allow repeats
  </label>
  <div id="fontControls">
    <button id="increaseFont">Increase Font</button>
    <button id="decreaseFont">Decrease Font</button>
  </div>
</div>

<div id="wheelContainer">
  <canvas id="wheelCanvas" width="500" height="500"></canvas>
  <button id="spinButton">Spin</button>
</div>

<script>
const groups = {};
let currentNames = [];
let fontSize = 16;
let currentRotation = 0;
let spinning = false;

const groupSelect = document.getElementById("groupSelect");
const wheelCanvas = document.getElementById("wheelCanvas");
const ctx = wheelCanvas.getContext("2d");

const textFiles = {
  "Red 1": "red1.txt",
  "Red 3": "red3.txt",
  "Red 4": "red4.txt",
  "Green 5": "green5.txt",
  "Green 6": "green6.txt",
  "Green 7": "green7.txt"
};

// Load names from text files
async function loadText(file) {
  const res = await fetch(file);
  const text = await res.text();
  return text.split(/\r?\n/).map(n => n.trim()).filter(n => n.length > 0);
}

// Initialize groups
async function init() {
  for (const [name, file] of Object.entries(textFiles)) {
    groups[name] = await loadText(file);
  }
  updateGroupSelect();
}

function updateGroupSelect() {
  groupSelect.innerHTML = "";
  for (const group in groups) {
    const option = document.createElement("option");
    option.value = group;
    option.textContent = group;
    groupSelect.appendChild(option);
  }
  loadGroup(groupSelect.value);
}

groupSelect.addEventListener("change", () => loadGroup(groupSelect.value));

function loadGroup(groupName) {
  currentNames = [...groups[groupName]];
  drawWheel(currentRotation);
}

// Draw wheel
function drawWheel(rotation = 0) {
  ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
  const numSlices = currentNames.length;
  if (numSlices === 0) return;
  const angleStep = (2 * Math.PI) / numSlices;

  ctx.save();
  ctx.translate(250, 250);
  ctx.rotate(rotation);

  currentNames.forEach((name, i) => {
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.fillStyle = `hsl(${(i * 360) / numSlices}, 70%, 60%)`;
    ctx.arc(0, 0, 250, i * angleStep, (i + 1) * angleStep);
    ctx.fill();

    ctx.save();
    ctx.rotate(i * angleStep + angleStep / 2);
    ctx.fillStyle = "black";
    ctx.textAlign = "right";
    ctx.font = `${fontSize}px Arial`;
    ctx.fillText(name, 230, 5);
    ctx.restore();
  });
  ctx.restore();

  // Draw fixed arrow at top
  ctx.beginPath();
  ctx.moveTo(250, 0);
  ctx.lineTo(240, 20);
  ctx.lineTo(260, 20);
  ctx.fillStyle = "red";
  ctx.fill();
}

// Spin button: animate wheel with slow-down easing
document.getElementById("spinButton").addEventListener("click", () => {
  if (spinning || currentNames.length === 0) return;
  spinning = true;

  const spins = 5 + Math.random() * 3;
  const targetRotation = currentRotation + spins * 2 * Math.PI;
  const duration = 4000;
  const startRotation = currentRotation;
  const startTime = performance.now();

  function animate(now) {
    const t = (now - startTime) / duration;
    if (t < 1) {
      const ease = 1 - Math.pow(1 - t, 3);
      currentRotation = startRotation + (targetRotation - startRotation) * ease;
      drawWheel(currentRotation);
      requestAnimationFrame(animate);
    } else {
      currentRotation = targetRotation;
      drawWheel(currentRotation);
      spinning = false;
    }
  }

  requestAnimationFrame(animate);
});

// Font size buttons
document.getElementById("increaseFont").addEventListener("click", () => {
  fontSize += 2;
  drawWheel(currentRotation);
});
document.getElementById("decreaseFont").addEventListener("click", () => {
  fontSize = Math.max(8, fontSize - 2);
  drawWheel(currentRotation);
});

init();
</script>
</body>
</html>
